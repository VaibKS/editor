"use strict";function printDir(e,t){if("undefined"==typeof t){if(e.length>0){var a="";for(var r in e)a+="folder"==e[r].type?printFolder(e[r],r):printFile(e[r],r);return a}}else{var i,n=$("#filesystem");n.html("");for(var i in e)"folder"==e[i].type?n.append(printFolder(e[i],i)):n.append(printFile(e[i],i));e.length>0?$(".downloadProject").css("display","block"):$(".downloadProject").hide()}}function printFolder(e,t){var a="<div class='folder' data-index='"+t+"'>"+e.name+"</div><div class='directory'>";return e.children.length>0&&(a+=printDir(e.children)),a+="</div>"}function printFile(e,t){return"<div class='file' data-index='"+t+"' data-id='"+e.id+"'>"+e.name+"</div>"}function printDirSort(e,t){if("undefined"==typeof t){var a="",r="";for(var i in e)"folder"==e[i].type?a+=printFolderSort(e[i],i):r+=printFile(e[i],i);return a+r}var a="",r="";for(var i in e)"folder"==e[i].type?a+=printFolderSort(e[i],i):r+=printFile(e[i],i);$("#filesystem").html(a+r),e.length>0?$(".downloadProject").css("display","block"):$(".downloadProject").hide()}function printFolderSort(e,t){var a="<div class='folder' data-index='"+t+"'>"+e.name+"</div><div class='directory'>";return e.children.length>0&&(a+=printDirSort(e.children)),a+="</div>"}function updateData(e,t,a){for(var r in e)if("file"==e[r].type){if(e[r].id==t)return e[r].data=a,!0}else e[r].children.length>0&&updateData(e[r].children,t,a)}function renameFile(e,t,a){for(var r in e)if("file"==e[r].type){if(e[r].id==t)return e[r].name=a,!0}else if(e[r].children.length>0)for(;renameFile(e[r].children,t,a);)return!0}function getFileData(e,t){for(var a in e)if("file"==e[a].type){if(e[a].id==t)return e[a]}else if(e[a].children.length>0)for(var r;r=getFileData(e[a].children,t);)return r;return!1}function getFolderPath(e){var t=[],a=[],r=e;for(t.push(Number(e.attr("data-index"))),r=r.parent();!r.hasClass("root");)t.push(Number(r.prev(".folder").attr("data-index"))),r=r.parent();return a.push({length:t.length}),a.push(t.reverse()),a}function message(e){$("#message .data").text(e),$("#message, #red-underlay").fadeIn()}function fileRoot(e,t){for(var a in dir)if(dir[a].type==t&&dir[a].name==e)return!0;return!1}function fileExists(e,t,a){var r,i=dir[tmp[0]],n=tmp.length-1;for("undefined"!=typeof a&&(n-=a),r=1;n>=r;r++)i=i.children[tmp[r]];i=i.children;for(r in i)if(i[r].type==t&&i[r].name==e)return!0;return!1}function insertSub(e,t,a){for(var r=dir[tmp[0]],i=1;a>i;i++)r=r.children[tmp[i]];console.log(r),"folder"==t?r.children.push({type:t,name:e,children:[]}):r.children.push({type:t,name:e,id:fCount++,data:""}),printDirSort(dir,0)}function insertInRoot(e,t){"file"==t?dir.push({type:"file",name:e,id:fCount++,data:""}):dir.push({type:"folder",name:e,children:[]}),printDirSort(dir,0)}function insert(e,t,a){"file"==t?dir[a].children.push({type:"file",name:e,id:fCount++,data:""}):dir[a].children.push({type:"folder",name:e,children:[]}),printDirSort(dir,0)}function saveFile(){var e=Number($("#tabs .active").attr("data-tab"));updateData(dir,e,editor.getValue())}function setLanguage(e){var t=e.substr(e.lastIndexOf(".")+1);switch(t=t.toLowerCase()){case"cpp":case"c":t="c_cpp";break;case"py":t="python";break;case"js":t="javascript"}editor.session.setMode("ace/mode/"+t),$("#lang-mode").val(t)}function getDirData(e,t){var a=[];for(var r in e)if("file"==e[r].type){if(e[r].id==t)return a.push(e[r]),a}else e[r].children.length>0&&getDirData(e[r].children,t)}function deleteRoot(e){dir.splice(e,1)}function deleteSub(){for(var e=dir[tmp[0]],t=1,a=tmp.length-1,r=1;a>r;r++)e=e.children[tmp[t++]];console.log(e),e.children.splice(tmp[a],1)}function getMaxID(e,t){}function getFileID(e,t){if("undefined"==typeof t){var a=[],r=[];for(var i in e)"file"==e[i].type?a.push(e[i].id):e[i].children.length>0&&(r=getFileID(e[i].children),a=a.concat(r));return a}var a=[],r=[];for(var i in e)"file"==e[i].type?a.push(e[i].id):e[i].children.length>0&&(r=getFileID(e[i].children),a=a.concat(r));return 0==a.length?!1:getMax(a)}function getMax(e){return e.reduce(function(e,t){return e>t?e:t})}function downloadZIP(e){var t=[],a=0;for(var r in dir)"file"==dir[r].type?e.file(dir[r].name,dir[r].data):(t.push(e.folder(dir[r].name)),dir[r].children.length>0&&(folderZIP(t[a],dir[r].children,e),console.log(t[a])),a++)}function folderZIP(e,t,a){var r=0,i=[];for(var n in t)"file"==t[n].type?e.file(t[n].name,t[n].data):(i.push(e.folder(t[n].name)),t[n].children.length>0&&folderZIP(i[r],t[n].children),r++)}var dir=[],fCount=0,save=[],openFiles=[],tmp=[],tempFile;$(function(){for(var e=10;51>e;e+=2)16!=e?$("#fontSizer").append($("<option>").val(e).text(e+"px")):$("#fontSizer").append($("<option>").val(e).attr("selected",!0).text(e+"px"));$(".full-height").height($(document).height()),localStorage.theme&&(editor.setTheme("ace/theme/"+localStorage.theme),$('option[value="'+localStorage.theme+'"]').attr("selected",!0)),localStorage.editorData&&(dir=JSON.parse(localStorage.editorData),dir.length>0&&(printDirSort(dir,0),message("Old Project Restored.")),fCount=getFileID(dir,0),fCount++,console.log(fCount),0==fCount&&(fCount=0)),"undefined"==typeof localStorage.visited&&($("#help").fadeIn(),localStorage.visited="true");var t=!1;$("#dragbar").mousedown(function(e){e.preventDefault(),t=!0,$(document).mousemove(function(e){t&&e.pageX>260&&e.pageY<500&&$("#sidebar").width(e.pageX)})}),$(document).mouseup(function(e){t=!1});var a=17,r=18,i=83,n=81,l=71,o=87,d=72,s=70,c=27,f=!1,u=!1,p=!1;$(document).keydown(function(e){var t=e.keyCode||e.which;t==c&&($(".esc").fadeOut(260),$("#container").removeClass("blur"),$("#fileName, #folderName").val(""),u=!0),t==a&&(p=!0),t==r&&(f=!0)}).keyup(function(e){var t=e.which||e.keyCode;t==a&&(p=!1),t==c&&(u=!1),t==r&&(f=!1)}),$(document).keydown(function(e){var t=e.keyCode||e.which;if(p){if(t==i)return e.preventDefault(),$("#saveTB").trigger("click"),!1;if(t==n)return e.preventDefault(),$("#tabs .active .close-tab").trigger("click"),!1;t==l&&(e.preventDefault(),$("#goToLine, #red-underlay").fadeIn(300),$("#toLineVal").focus(),$("#container").addClass("blur"))}else if(f){if(console.log("altt"),t==d)return e.preventDefault(),$("#help").fadeToggle(),!1;t==s&&(e.preventDefault(),$("#maximize").trigger("click"))}else if(u){e.preventDefault();var a=e.key||String.fromCharCode(t);if(Number(a)>=0&&(e.preventDefault(),console.log(t+" shift"),$("#tabs .tab:nth-child("+(Number(a)+1)+")").trigger("click")),t==o)e.preventDefault(),$("#tabs .active").next().trigger("click");else if(t==n){e.preventDefault();var r=$("#tabs .active").prev();r.hasClass("tab")&&r.trigger("click")}}})}),$("#sidebar").on("contextmenu",function(e){var t=[];e.preventDefault(),e.stopPropagation(),$(".file, .folder").removeClass("action-highlight");var a=$(e.target);return a.hasClass("file")?($(".folder-action").hide(),$(".file-action").show(),t=getFolderPath(a),tempFile=Number(a.attr("data-id")),$("#folderPath, #filePath").val(t[0].length),tmp=t[1],$("#deleteFileName").text(a.text())):a.hasClass("folder")?($(".folder-action").show(),$(".file-action").hide(),t=getFolderPath(a),$("#folderPath, #filePath").val(t[0].length),tmp=t[1],$("#deleteFolderName").html(a.text())):($(".folder-action").show(),$(".file-action, .root-action").hide(),$("#folderPath, #filePath").val(1),tmp=[]),a.addClass("action-highlight"),$("#actions").css({top:e.pageY,left:e.pageX}).slideDown(200),!1}),$(".full-action").click(function(){var e=$(this).attr("data-action");$("#actions").hide(),$("#"+e+", #red-underlay").fadeIn(300),$("#container").addClass("blur"),$("#"+e+" input").focus(),e.indexOf("delete")>0&&$("#"+e+" button").focus()}),$(".direct-action").click(function(e){var t=$(e.target),a=t.attr("data-action");if("edit"==a){saveFile();var r=t.text();if(setLanguage(r),$(".tab").removeClass("active"),openFiles.indexOf(tempFile)>=0)return $('.tab[data-tab="'+tempFile+'"]').addClass("active").click(),!1;var i={};i=getFileData(dir,tempFile),console.log(i),$("#tabs").append($("<div>").addClass("tab active").attr("data-tab",tempFile).html(i.name).append($("<div>").addClass("close-tab").text("X"))),editor.setValue(i.data),openFiles.push(tempFile)}else if("download"==a){var n=getFileData(dir,tempFile),l=new Blob([n.data],{type:"text/plain;charset=utf-8"});saveAs(l,n.name)}else $("#renameFile, #red-underlay").fadeIn(200),$("#renameInput").val(getFileData(dir,tempFile).name).focus();$("#actions").fadeOut(300)}),$("#newFolder form").submit(function(e){e.preventDefault(),e.stopPropagation();var t=$("#folderName"),a=Number($("#folderPath").val()),r=t.val();if(0==r.length)return!1;if(1==a){if(0==tmp.length){if(fileRoot(r,"folder"))return message("Folder '"+r+"' already exists"),$("#newFolder").fadeOut(),t.val(""),!1;insertInRoot(r,"folder")}else{if(fileExists(r,"folder"))return message("Folder '"+r+"' already exists"),$("#newFolder").fadeOut(),t.val(""),!1;insert(r,"folder",tmp[0])}t.val("")}else if(a>1){if(fileExists(r,"folder"))return message("Folder '"+r+"' already exists"),$("#newFolder").fadeOut(),t.val(""),!1;insertSub(r,"folder",a)}else console.log("Error");$("#newFolder, #red-underlay").fadeOut(),$("#container").removeClass("blur"),$("#newFolder input").val("")}),$("#newFile form").submit(function(e){e.preventDefault(),e.stopPropagation();var t=$("#fileName"),a=Number($("#filePath").val()),r=t.val();if(0==r.length)return!1;if(1==a){if(0==tmp.length){if(fileRoot(r,"file"))return message("File '"+r+"' already exists"),$("#newFile").fadeOut(),t.val(""),!1;insertInRoot(r,"file")}else{if(fileExists(r,"file"))return message("File '"+r+"' already exists"),$("#newFile").fadeOut(),t.val(""),!1;insert(r,"file",tmp[0])}t.val("")}else if(a>1){if(console.log("sub"),fileExists(r,"file"))return message("File '"+r+"' already exists"),$("#newFile").fadeOut(),t.val(""),!1;insertSub(r,"file",a)}else console.log("Error");$("#newFile, #red-underlay").fadeOut(),$("#container").removeClass("blur"),t.val("")}),$("#renameFile form").submit(function(e){e.preventDefault(),e.stopPropagation();var t=$("#renameInput").val();if(t.length<2)return!1;if(1==tmp.length){if(console.log(tmp),fileRoot(t,"file"))return $(".esc").fadeOut(50),message("File already exists"),!1}else if(tmp.length>1&&(console.log("Run"),fileExists(t,"file",1)))return $(".esc").fadeOut(50),message("File already exists"),!1;return renameFile(dir,Number(tempFile),t),$('.tab[data-tab="'+tempFile+'"]').text(t).append($("<div>").addClass("close-tab").text("X")),printDirSort(dir,0),$(".esc").fadeOut(100),!1}),$("#tabs").on("click",".close-tab",function(e){var t=$(this).parent(),a=t.attr("data-tab");return $(this).hasClass("active")&&(saveFile(),console.log("Saving current file...")),t.remove(),openFiles.splice(openFiles.indexOf(a),1),$(".tab").first().click(),0==openFiles.length?editor.setValue(""):$("#acor").removeAttr("data-ta"),!1}),$("#tabs").on("click",".tab",function(e){var t=$(this),a=t.clone().children().remove().end().text();setLanguage(a),saveFile();var r=Number(t.attr("data-tab"));$(".tab").removeClass("active"),t.addClass("active");var i=getFileData(dir,r);editor.setValue(i.data)}),$(".root").on("dblclick",".file",function(e){e.preventDefault(),saveFile();var t=$(this),a=t.clone().children().remove().end().text();setLanguage(a);var r=Number(t.attr("data-id"));if($(".tab").removeClass("active"),openFiles.indexOf(r)>=0)return saveFile(),$('.tab[data-tab="'+r+'"]').addClass("active").click(),!1;var i={};i=getFileData(dir,r),$("#tabs").append($("<div>").addClass("tab active").attr("data-tab",r).text(i.name).append($("<div>").addClass("close-tab").text("X"))),$("#acor").attr("data-ta",r),editor.setValue(i.data),openFiles.push(r)}),$("#deleteFolderBtn, #deleteFileBtn").click(function(e){var t=$(this);return t.attr("disabled",!0),tmp.length<=0?!1:(1==tmp.length?deleteRoot(tmp[0]):deleteSub(),printDirSort(dir,0),$("#deleteFolder, #deleteFile, #red-underlay").fadeOut(260),$("#container").removeClass("blur"),void setTimeout(function(){t.removeAttr("disabled")},2200))}),$("#goToLine").submit(function(e){e.preventDefault();var t=Number($("#toLineVal").val());return console.log("Going to %d",t),editor.gotoLine(t),$(".esc").fadeOut(),$("#container").removeClass("blur"),!1}),$("#maximize").click(function(){$(this).toggleClass("full"),$("#sidebar, #dragbar").fadeToggle()}),$(".help-menu-act").click(function(){var e=$(this);if(!e.hasClass("active")){var t=e.attr("data-help");$(".help-menu-act").removeClass("active"),e.addClass("active"),$(".help-content").hide(),$('.help-content[data-help="'+t+'"]').fadeIn()}}),$(".root").on("click",".folder",function(){$(this).next(".directory").slideToggle()});var $popup=$("#actions"),pHov=!1;$popup.hover(function(){pHov^=1}),$(document).mousedown(function(e){1==e.which&&(pHov||$popup.slideUp(240),$(".file, .folder").removeClass("action-highlight"))}),$(".close").click(function(e){e.preventDefault(),$(this).parent().fadeOut(300),$("#red-underlay").fadeOut(300),$("#container").removeClass("blur")}),$(".close-par").click(function(e){e.preventDefault(),$(this).parent().parent().fadeOut(300),$("#red-underlay").fadeOut(300),$("#container").removeClass("blur")}),$("#lang-mode").change(function(){editor.session.setMode("ace/mode/"+$(this).val())}),$("#downloadTB").click(function(){var e=$(this).attr("disabled",!0);if(0==openFiles.length)return!1;$("#saveTB").trigger("click");var t=$(".tab.active").attr("data-tab"),a=editor.getValue(),r=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(r,getFileData(dir,t).name),e.text("Downloaded").addClass("green"),setTimeout(function(){e.text("Download").removeClass("green").removeAttr("disabled")},3500)}),$("#saveTB").click(function(){if(0==dir.length)return!1;var e=$(this),t=Number($("#tabs .active").attr("data-tab"));updateData(dir,t,editor.getValue()),e.text("Saved in Browser Local Storage.").addClass("green"),setTimeout(function(){e.text("Save").removeClass("green")},3500),localStorage.editorData=JSON.stringify(dir)}),$("#fontSizer").change(function(){$("#acor").css("font-size",$(this).val()+"px")}),$(".downloadProject").click(function(){var e=$(this),t=$(this).text();if(e.attr("disabled",!0),$("#saveTB").trigger("click"),0==dir.length)return e.text("Error! Try again."),setTimeout(function(){e.text(t).removeAttr("disabled")},3600),!1;if("zip"==e.attr("data-type")){var a=new JSZip;downloadZIP(a),a.generateAsync({type:"blob"}).then(function(e){saveAs(e,"myProject.zip")})}else{var r=new Blob([JSON.stringify(dir)],{type:"text/plain;charset=utf-8"});saveAs(r,"myProject.json")}e.text("Downloaded"),setTimeout(function(){e.text(t).removeAttr("disabled")},3600)}),$("#loadProject").click(function(){$("#projectFile").trigger("click")}),$("#projectFile").change(function(){var e=document.getElementById("projectFile"),t=e.files[0],a="",r=new FileReader;r.onload=function(e){a=r.result,a=JSON.parse(a),dir=a,message("Project Restored."),printDirSort(dir,0)},r.readAsText(t)}),$("#themer").change(function(){var e=$(this).val();editor.setTheme("ace/theme/"+e),localStorage.theme=e});
